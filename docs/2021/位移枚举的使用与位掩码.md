# ä½ç§»æšä¸¾çš„ä½¿ç”¨ä¸ä½æ©ç 

## å‰è¨€

æˆ‘ä»¬åœ¨ Objective-C ä»£ç é‡Œç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„æšä¸¾ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼Ÿå°±å†™ä¸ªæšä¸¾è€Œå·²è¿˜æ•´ä¸Šä½è¿ç®—äº†ï¼Ÿ

```
typedef NS_OPTIONS(NSUInteger, UIControlState) {

  UIControlStateNormal    = 0,

  UIControlStateHighlighted = 1 << 0,         // used when UIControl isHighlighted is set

  UIControlStateDisabled   = 1 << 1,

  UIControlStateSelected   = 1 << 2,         // flag usable by app (see below)

  UIControlStateFocused API_AVAILABLE(ios(9.0)) = 1 << 3, // Applicable only when the screen supports focus

  UIControlStateApplication = 0x00FF0000,       // additional flags available for application use

  UIControlStateReserved   = 0xFF000000        // flags reserved for internal framework use

};
```

## åœºæ™¯æ£æµ‹

-   æœ‰1ä¸ª button

-   æœ‰ä¸€ä¸ªäº‹ä»¶æšä¸¾UIControlEventsï¼ŒåŒ…å«å¤šä¸ªæ‰‹åŠ¿ç±»å‹

-   æœ‰ä¸¤ä¸ªäº‹ä»¶å¤„ç†å‡½æ•° touchUp å’Œ touchDown

-   ç»™ button æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¦æ±‚ï¼š

    -   ç›‘å¬ UIControlEventTouchUpInside ç»‘å®š touchUp æ–¹æ³•
    -   ç›‘å¬ UIControlEventTouchDown ç»‘å®š touchDown æ–¹æ³•

### é¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•

æ³¨å†Œä¸¤ä¸ªäº‹ä»¶å‘—

```
[btn addTarget:self action: @selector(touchUp) forControlEvents:UIControlEventTouchUpInside];

[btn addTarget:self action: @selector(touchDown) forControlEvents:UIControlEventTouchDown];
```

### Apple å®˜æ–¹åšæ³•

```
[btn addTarget:self action: @selector(touchUp) forControlEvents:UIControlEventTouchUpInside | UIControlEventTouchDown];
```

![excuse_me.png](../images/2021/excuse_me.png)

**ä¸ºä»€ä¹ˆåªç”¨ä¸€è¡Œä»£ç èƒ½æ³¨å†Œä¸¤ä¸ªäº‹ä»¶ï¼ŸforControlEvents æ˜æ˜åªæ¥æ”¶ä¸€ä¸ªå‚æ•°å•Šï¼Ÿ**

**åé¢çš„æˆ–è¿ç®—ä»€ä¹ˆé¬¼ï¼Ÿ**

ç‚¹è¿›å»çœ‹çœ‹ UIControlEvents å…¶å®æ˜¯ä¸ªæšä¸¾

```
typedef NS_OPTIONS(NSUInteger, UIControlEvents) {

  UIControlEventTouchDown                     = 1 << 0,   // on all touch downs

  UIControlEventTouchDownRepeat                  = 1 << 1,   // on multiple touchdowns (tap count > 1)

  UIControlEventTouchDragInside                  = 1 << 2,

  UIControlEventTouchDragOutside                 = 1 << 3,

  UIControlEventTouchDragEnter                  = 1 << 4,

  UIControlEventTouchDragExit                   = 1 << 5,

  UIControlEventTouchUpInside                   = 1 << 6,

  UIControlEventTouchUpOutside                  = 1 << 7,

  UIControlEventTouchCancel                    = 1 << 8,



  UIControlEventValueChanged                   = 1 << 12,   // sliders, etc.

  UIControlEventPrimaryActionTriggered API_AVAILABLE(ios(9.0)) = 1 << 13,   // semantic action: for buttons, etc.



  UIControlEventEditingDidBegin                  = 1 << 16,   // UITextField

  UIControlEventEditingChanged                  = 1 << 17,

  UIControlEventEditingDidEnd                   = 1 << 18,

  UIControlEventEditingDidEndOnExit                = 1 << 19,   // 'return key' ending editing



  UIControlEventAllTouchEvents                  = 0x00000FFF, // for touch events

  UIControlEventAllEditingEvents                 = 0x000F0000, // for UITextField

  UIControlEventApplicationReserved                = 0x0F000000, // range available for application use

  UIControlEventSystemReserved                  = 0xF0000000, // range reserved for internal framework use

  UIControlEventAllEvents                     = 0xFFFFFFFF

};
```

wocï¼Œè¿™ä¸ªæšä¸¾ä¸ç®€å•ï¼Œç«Ÿç„¶è¿˜æœ‰ä½è¿ç®—ã€‚

å¸¸è§„ç†è§£ï¼Œæšä¸¾å°±æ˜¯ä¸€å †å¸¸é‡ï¼Œæ˜¯å›ºå®šçš„æ­»å€¼ï¼Œå®ƒå†æ˜¯ä½è¿ç®—ï¼Œä»–ä¹Ÿæ˜¯æ­»å€¼ï¼Œå°±ç®— 1 << 2 = 4ï¼Œè¿™ä¸ª 4 ä¹Ÿæ˜¯å›ºå®šçš„ã€‚

å›çœ‹ä¸Šé¢ç»™ button æ·»åŠ äº‹ä»¶çš„æ—¶å€™ç”¨åˆ°çš„ UIControlEvents æšä¸¾ï¼Œé‚£é‡Œçš„æˆ–è¿ç®—ä¸æšä¸¾é‡Œçš„ä½è¿ç®—è‚¯å®šæœ‰æŸç§å…³ç³»

UIControlEventTouchUpInside(1 << 6) | UIControlEventTouchDown(1 << 0) ç»“æœä¸ºï¼š

1000000

0000001

***

1000001

æ‰€ä»¥UIControlEventsæœ€ç»ˆæ¥æ”¶åˆ°çš„å€¼æ˜¯ 1000001

**Qï¼šé‚£ä¹ˆæ€ä¹ˆåˆ¤å®š 1000001 æ—¢ç­‰äº 1000000 æœ‰ç­‰äº 1 æˆç«‹å‘¢ï¼Ÿ**

**Aï¼šä¸ç”¨ = å·ï¼Œè€Œä½¿ç”¨ä¸è¿ç®— &**

```
- (void)addTarget:(nullable id)target action:(SEL)action forControlEvents:(UIControlEvents)controlEvents {

    if (controlEvents & UIControlEventTouchUpInside) {

        // TouchUp é€»è¾‘

    }

    if (controlEvents & UIControlEventTouchDown) {

        // TouchDown é€»è¾‘

    }

    ...

}
```

ç”±äº 1000001 æ˜¯ç”± 1000000 å’Œ 1 è¿›è¡Œæˆ–è¿ç®—å¾—åˆ°çš„ï¼Œæ‰€ä»¥

1000001 & 1000000 = 1 (true)

1 & 1000000 = 1000000 (true)

å³ä¸Šé¢ä¸¤ä¸ª if åˆ¤æ–­æˆç«‹ï¼Œèƒ½å¤Ÿæ³¨å†ŒUIControlEventTouchUpInsideå’ŒUIControlEventTouchDownäº‹ä»¶

**ä»€ä¹ˆï¼Ÿçä¼ ä¸€ä¸ªå¤§å€¼ä¸å°±èƒ½ä¸å°æŒ‡ä¸è¿ç®—æˆåŠŸäº†ï¼Ÿ**

1.  çä¼ æšä¸¾ç¼–è¯‘è¿‡ä¸å»ï¼Œå¿…é¡»æ˜¯æŒ‡å®šæšä¸¾å€¼
2.  æšä¸¾å€¼å†…éƒ½æ˜¯å‘å·¦ä½ç§»è¿ç®—çš„ï¼Œå…¨æ˜¯ 1 åé¢è·Ÿç€æ•°ä¸ª0ï¼Œä¸å­˜åœ¨ 11111 è¿™ç§ä¸‡èƒ½å€¼ï¼ˆé™¤éè‡ªå·±å®šä¹‰ä¸€ä¸ªç”¨æ¥åŒ¹é…æ‰€æœ‰å€¼çš„ä¸‡èƒ½å€¼ï¼Œå¦‚ UIControlEventAllEventsï¼‰

### å¥‡æ€ªçš„çŸ¥è¯† - ä½æ©ç 

> ä»€ä¹ˆæ˜¯â€ä½æ©ç â€œã€‚
> ä½æ©ç ï¼ˆBitMaskï¼‰ï¼Œæ˜¯â€ä½ï¼ˆBitï¼‰â€œå’Œâ€æ©ç ï¼ˆMaskï¼‰â€œçš„ç»„åˆè¯ã€‚â€ä½â€œæŒ‡ä»£ç€äºŒè¿›åˆ¶æ•°æ®å½“ä¸­çš„äºŒè¿›åˆ¶ä½ï¼Œè€Œâ€æ©ç â€œæŒ‡çš„æ˜¯ä¸€ä¸²ç”¨äºä¸ç›®æ ‡æ•°æ®è¿›è¡ŒæŒ‰ä½æ“ä½œçš„äºŒè¿›åˆ¶æ•°å­—ã€‚ç»„åˆèµ·æ¥ï¼Œå°±æ˜¯â€ç”¨ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—ï¼ˆæ©ç ï¼‰å»æ“ä½œå¦ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—â€œçš„æ„æ€ã€‚

![](../images/2021/qiguai.png)

é‡æ–°è®¾è®¡ä¸Šé¢ç‚¹å‡»äº‹ä»¶çš„æ —å­ï¼Œå®šä¹‰ä¸€ä¸ªå…³äºæƒé™çš„æšä¸¾

```
typedef enum {

  roleA = 1 << 0, // 1ï¼ˆåè¿›åˆ¶ 1ï¼‰

  roleB = 1 << 1, // 10ï¼ˆåè¿›åˆ¶ 2ï¼‰

  roleC = 1 << 2, // 100ï¼ˆåè¿›åˆ¶ 4ï¼‰

}AuthType;
```

#### å¸¸è§„æ–¹æ³•

ç»™å½¦ç¥–åˆ†é…ä¸¤ä¸ªè§’è‰² roleA å’Œ roleC

```
NSMutableArray *auths = [NSMutableArray new];

[auths addObject:@(roleA)];

[auths addObject:@(roleC)];
```

åˆ¤æ–­å½¦ç¥–æœ‰å“ªäº›è§’è‰²ï¼Œå¹¶åšç›¸å…³æ“ä½œ

```
[auths enumerateObjectsUsingBlock:^(id _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {

    if ([obj isEqual: @(roleA)]) {

      NSLog(@"ç»™å½¦ç¥–ä¸€ä¸ªé¢å…·");

    }

    if ([obj isEqual: @(roleB)]) {

      NSLog(@"ç»™å½¦ç¥–ä¸€æŠŠæª");

    }

    if ([obj isEqual: @(roleC)]) {

      NSLog(@"ç»™å½¦ç¥–ä¸€ä¸ªæˆé¾™");

    }

 }];
```

#### ä½æ©ç æ–¹æ³•

ç»™å½¦ç¥–åˆ†é…ä¸¤ä¸ªè§’è‰² roleA å’Œ roleB

é€šè¿‡æˆ–è¿ç®—èµ‹äºˆå€¼

```
NSInteger auth = roleA | roleC;
```

åˆ¤æ–­å½¦ç¥–æœ‰å“ªäº›è§’è‰²ï¼Œå¹¶åšç›¸å…³æ“ä½œã€‚

è¿™é‡Œå½¦ç¥–æƒé™ä¸º authï¼Œä½æ©ç ä¸ºå„ä¸ªæšä¸¾å€¼ï¼Œé€šè¿‡ä¸è¿ç®—å€¼åˆ¤æ–­æ˜¯å¦ä¸º true

```
if (auth & roleA) {

    NSLog(@"ç»™å½¦ç¥–ä¸€ä¸ªé¢å…·");

}

if (auth & roleB) {

    NSLog(@"ç»™å½¦ç¥–ä¸€æŠŠæª");

}

if (auth & roleC) {

    NSLog(@"ç»™å½¦ç¥–ä¸€ä¸ªæˆé¾™");

}
```

å¯¹æ¯”ä¸€ä¸‹ä¼˜åŠ¿æ˜æ˜¾ï¼Œä¸€ä¸ªæ•´å‹ä»£æ›¿æ•°ç»„ï¼ŒåŒæ—¶é¿å…äº†æ•°ç»„éå†ã€‚

**æˆ–è¿ç®—ï¼šå› ä¸ºä½æ©ç éƒ½æ˜¯ 1 åé¢è·Ÿè‹¥å¹²ä¸ª 0ï¼Œè¿›è¡Œæˆ–è¿ç®—ç›¸å½“äºæŠŠæœ‰ 1 çš„ä½æ•°éƒ½æ‹¼å‡‘åˆ°ä¸€èµ·ï¼Œæœ‰ 1 çš„å³æ‹¥æœ‰å¯¹åº”ä½çš„æƒé™ã€‚**

**ä¸è¿ç®—ï¼šä½æ©ç çš„ä½ç½®æœ‰ 1 ä¸”å¯¹åº”è®¡ç®—çš„å€¼ä½ç½®ä¹Ÿæ˜¯ 1 ç»“æœæ‰æ˜¯ 1ï¼Œæœ‰å†å¤šçš„ 1 å¦‚æœä¸ä½æ©ç å¯¹åº”ä¸ä¸Šï¼Œç»“æœåªèƒ½æ˜¯ 0ï¼Œboolean ä¸º false**

## JavaScript æä¸ªä¾‹å­**ğŸŒ°**

### è¦æ±‚

-   æœ‰3ä¸ª buttonï¼šbtn1ã€btn2ã€btn3

-   æœ‰ä¸€ä¸ªäº‹ä»¶æšä¸¾: touchDown(é¼ æ ‡æŒ‰ä¸‹)ã€touchUp(é¼ æ ‡æŠ¬èµ·)ã€doublieTouch(åŒå‡»)

-   æœ‰3ä¸ªåŸ‹ç‚¹å‡½æ•°ï¼Œåˆ†åˆ«è´Ÿè´£ï¼štouchDownLog(é¼ æ ‡æŒ‰ä¸‹)ã€touchUpLog(é¼ æ ‡æŠ¬èµ·)ã€doublieTouchLog(åŒå‡»)

-   ç»™ button æ·»åŠ åŸ‹ç‚¹ï¼Œè¦æ±‚ï¼š

    -   btn1 ç›‘å¬ touchDown ä¸ touchUp
    -   btn2 ç›‘å¬ touchDown ä¸ doublieTouch
    -   btn3 ç›‘å¬ touchDown ä¸ touchUp ä¸ doublieTouch

### å¸¸è§„åšæ³•

```
const touchDown = 'touchDown';

const touchUp = 'touchUp';

const doublieTouch = 'doublieTouch';



function addEventListener(ele, eventTypes) {

    eventTypes.forEach(eventType => {

        ele.addEventListener(eventType, () => {

            if (eventType === touchDown) {

                ele.addEventListener('mousedown', log(touchDown));

            }

            if (eventType === touchUp) {

                ele.addEventListener('mouseup', log(touchUp));

            }

            if (eventType === doublieTouch) {

                ele.addEventListener('dblclick', log(doublieTouch));

            }

        });

    });

}



addEventListener(btn1, [touchDown, touchUp]);

addEventListener(btn2, [touchDown, doublieTouch]);

addEventListener(btn3, [touchDown, touchUp, doublieTouch]);
```

### ä½ç§»æšä¸¾åšæ³•

```
const touchDown = 1 << 0;

const touchUp = 1 << 1;

const doublieTouch = 1 << 2;



function addEventListener(ele, eventType) {

    if (eventType & touchDown) {

        ele.addEventListener('mousedown', log(touchDown));

    }

    if (eventType & touchUp) {

        ele.addEventListener('mouseup', log(touchUp));

    }

    if (eventType & doublieTouch) {

        ele.addEventListener('dblclick', log(doublieTouch));

    }

}



addEventListener(btn1, touchDown | touchUp);

addEventListener(btn2, touchDown | doublieTouch);

addEventListener(btn2, touchDown | touchUp | doublieTouch);
```

åŒæ ·çš„å‡ è¡Œåˆ¤æ–­ï¼Œå°‘äº†ä¸€å±‚æ•°ç»„å’Œå¯¹æ•°ç»„çš„éå†

![](../images/2021/beautiful.png)